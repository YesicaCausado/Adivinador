<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Adivina la Canci√≥n üé∂</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #1e1e2f, #2d2d44);
      color: #fff;
      margin: 0;
    }

    .container {
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
      width: 350px;
    }

    h1 {
      font-size: 1.8em;
      margin-bottom: 15px;
      color: #ffcc70;
    }

    button {
      background: #ffcc70;
      border: none;
      padding: 12px 20px;
      margin: 10px;
      border-radius: 12px;
      font-size: 1em;
      cursor: pointer;
      transition: 0.3s;
      width: 90%;
    }

    button:hover {
      background: #ffb347;
      transform: scale(1.05);
    }

    .options {
      margin-top: 20px;
    }

    .message {
      margin-top: 15px;
      font-weight: bold;
      font-size: 1.1em;
    }

    /* iframe oculto solo para reproducir el audio */
    #player {
      width: 1px;
      height: 1px;
      position: absolute;
      left: -9999px;
      top: -9999px;
      visibility: hidden;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé∂ Adivina la Canci√≥n</h1>
    <button onclick="playSnippet()">‚ñ∂Ô∏è Reproducir fragmento</button>
    <div class="options" id="options"></div>
    <div class="message" id="message"></div>
  </div>

  <div id="player"></div>

  <script>
    const apiKey = "AIzaSyBWM6ZPP0ZG-I8yZJD3oE5C3ap52JCyCFQ"; // üîë pon tu API Key de YouTube
    let songs = [];
    let correctSong = null;
    let player;

    // Cargar canciones populares
    async function loadSongs() {
      try {
        const res = await fetch(
          `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&chart=mostPopular&videoCategoryId=10&maxResults=20&key=${apiKey}`
        );
        const data = await res.json();

        // Filtrar resultados v√°lidos que tengan videoId
        songs = data.items.filter(
          item => item.id && item.id.videoId && item.snippet
        );

        pickSong();
      } catch (err) {
        console.error("Error cargando canciones:", err);
      }
    }

    function pickSong() {
      if (songs.length < 4) return;

      correctSong = songs[Math.floor(Math.random() * songs.length)];

      let options = [correctSong];
      while (options.length < 4) {
        let candidate = songs[Math.floor(Math.random() * songs.length)];
        if (!options.includes(candidate)) options.push(candidate);
      }

      options = options.sort(() => Math.random() - 0.5);

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      options.forEach(song => {
        const btn = document.createElement("button");
        btn.textContent = song.snippet.title;
        btn.onclick = () => checkAnswer(song);
        optionsDiv.appendChild(btn);
      });
    }

    function checkAnswer(song) {
      const message = document.getElementById("message");
      if (song.id.videoId === correctSong.id.videoId) {
        message.textContent = "‚úÖ ¬°Correcto!";
        message.style.color = "#7CFC00";
      } else {
        message.textContent = "‚ùå Incorrecto. Era: " + correctSong.snippet.title;
        message.style.color = "#FF6B6B";
      }

      setTimeout(pickSong, 2000);
    }

    // Reproducir fragmento de audio
    function playSnippet() {
      if (!correctSong) return;

      if (player) player.destroy();

      player = new YT.Player("player", {
        videoId: correctSong.id.videoId,
        playerVars: { autoplay: 1 },
        events: {
          onReady: e => {
            e.target.unMute();
            e.target.playVideo();

            setTimeout(() => {
              e.target.stopVideo();
            }, 10000); // üéµ 10 segundos de audio
          }
        }
      });
    }

    // Cargar API de YouTube
    let tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    window.onYouTubeIframeAPIReady = loadSongs;
  </script>
</body>
</html>
